<!DOCTYPE html>
<html><head>
	<title>chyhcode.github.io</title>
	<meta charset="UTF-8">
	<!-- Bootstrap 4 -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
	<style>
		a {display: block;}
		td {width: 20%;}
	</style>
</head>
<body class="container-xl">
	<h1>使用方式</h1>
	<h3>IE</h3>
	<p>
		顯示IE的[我的最愛列]：瀏覽器最上端空白的地方按右鍵，把[我的最愛列]打勾<br>
		將下列連結右鍵加到至我的最愛列（注意放的位置是我的最愛"列"，不是我的最愛）、或拖拉到我的最愛列<br>
		在病人的某個頁面，點我的最愛即可快速跳轉
	</p>
	<h3>chrome</h3>
	<p>
		顯示chrome的[書籤列]：右上角 [三個點(更多)] > [書籤] > [顯示書籤列]，或是 ctrl+shift+B<br>
		將下列連結右鍵加到至書籤列、或拖拉到書籤列<br>
		在病人的某個頁面，點我的最愛即可快速跳轉
	</p>
	<h2>原理</h2>
	<p>以在"主畫面"跳至"生命徵象"為例，先看兩者的網址<br>
		主畫面的網址是 <code>http://....../ConfirmDiagnosisOrder.aspx?...搜索參數...</code><br>
		生命徵象網址是 <code>http://....../VitalSign_TPR.aspx?...搜索參數...</code><br>
	</p>
	<p>
		以下連結裡面的程式碼做的事，就是將主畫面的 <code>...搜索參數...</code> 複製<br>
		開起一個新分頁，新分頁的網址是: <code>http://....../VitalSign_TPR.aspx?</code> 加上 <code>...搜索參數...</code><br>
		等於手動告訴伺服器我要去這個病人的生命徵象頁面~
	</p>
	<p>大部分頁面可以互相跳轉，但因為某些特殊頁面的網址需要的 <code>搜索參數</code> 比較複雜，因此無法正確跳至該頁面，尤其是報告系統、PACS、EMR</p>	
	<table class="table text-center">
		<thead class="thead-light">
			<tr>
				<th>病史</th>
				<th>查詢</th>
				<th>報&影</th>
				<th>處置</th>
				<th>出入</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/ConfirmDiagnosisOrder.aspx' + location.search, 'ConfirmDiagnosisOrder');">主</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/InsertProgressNoteContent.aspx' + location.search, 'InsertProgressNoteContent' );">程</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/PatientMedicalRecordListQuery.aspx' + location.search, 'PatientMedicalRecordListQuery' );">史</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/MedicationHistory/Default.aspx' + location.search, 'MedicationHistory' );">藥史</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/SimpleInfoShowUsingPlaceHolder.aspx' + location.search.replace(/Func=[A-Za-z]+/,'') + '&Func=ProgressNote', 'ProgressNote');">程s</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/SimpleInfoShowUsingPlaceHolder.aspx' + location.search.replace(/Func=[A-Za-z]+/,'') + '&Func=AdmissionNote', 'AdmissionNote');">入摘</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/SimpleInfoShowUsingPlaceHolder.aspx' + location.search.replace(/Func=[A-Za-z]+/,'') + '&Func=OPNoteList', 'OPNoteList');">術紀</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/SimpleInfoShowUsingPlaceHolder.aspx' + location.search.replace(/Func=[A-Za-z]+/,'') + '&Func=DischargeSummaryByPersonID', 'DischargeSummaryByPersonID');">出摘s</a>
					<a href="javascript: open('http://hisaw.ntuh.gov.tw/WebApplication/Clinics/WinFormPopupMedicalRecord.aspx' + location.search, 'WinFormPopupMedicalRecord' );">EMR</a>
				</td>
				<td>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Nursing/VitalSign_TPR.aspx' + location.search, 'VitalSign_TPR' );">生</a>
					<a href='javascript: document.querySelectorAll("#NTUHWeb1_TPRDrugSvgBox_svgContainer > svg > [onmouseout]").forEach(function(svg){svg.innerHTML="<title>"+(svg.getAttribute("onmouseover")||svg.getAttribute("onmousemove")).match(/"(.+)"/)[1]+"</title>"+svg.innerHTML;svg.removeAttribute("onmouseover");svg.removeAttribute("onmousemove");svg.removeAttribute("onmouseout");})' title="在TPR頁面點擊書籤按鈕，修正chrome沒辦法顯示藥物的錯誤">生(chrome修正)</a>
					<a href='javascript: {if(window.NodeList&&!NodeList.prototype.forEach){NodeList.prototype.forEach=Array.prototype.forEach;}document.querySelectorAll("#NTUHWeb1_TPRDrugSvgBox_svgContainer > svg > [onmouseout]").forEach(function(s){if(s.matches("text")){s.classList.add("svg-drug");s.generic=s.textContent;}else if(s.matches("path[stroke=\"red\"]")){s.classList.add("svg-cancel");}else if(s.matches("path[stroke=\"black\"]")){s.classList.add("svg-given");}else if(s.matches("path")){s.classList.add("svg-short-term");}else if(s.matches("line")){s.classList.add("svg-long-term");}s.setAttribute("onmouse",s.getAttribute("onmouseover")||s.getAttribute("onmousemove"));s.setAttribute("title",s.getAttribute("onmouse").match(/\"(.+)\"/)[1]);s.setAttribute("index",s.getAttribute("onmouse").match(/,([0-9]+)\)/)[1]);s.innerHTML="<title>"+s.getAttribute("title")+"</title>"+s.innerHTML;s.removeAttribute("onmouseover");s.removeAttribute("onmousemove");s.removeAttribute("onmouseout");});function standarizeDate(d){d=d.match(/([0-9]+)\/([0-9]+)( |-|$)/);return((d[1].length==1)?("0"+d[1]):d[1])+"/"+((d[2].length==1)?("0"+d[2]):d[2]);}let table=[];document.querySelectorAll("#NTUHWeb1_TPRDrugSvgBox_svgContainer > svg > text[y=\"12\"]").forEach(function(t){let d=standarizeDate(t.textContent);table.push({date:d,x:Number(t.getAttribute("x")),sugar:{TID1:[],TID2:[],TID3:[],HS:[]},insulin:{TID1:[],TID2:[],TID3:[],HS:[]}});table[d]=table[table.length-1];});let insulins=[{type:"L",name:"Tresiba",keyword:"TRESIBA",generic:"Insulin Degludec",brand:"Tresiba FlexTouch 300 U/3 mL/pen"},{type:"L",name:"Levemir",keyword:"LEVEMIR",generic:"Insulin Detemir",brand:"Levemir FlexPen 300 U/3 mL/pen"},{type:"L",name:"Lantus",keyword:"LANTUS",generic:"Insulin Glargine",brand:"Lantus Solution for Injection (SoloStar), 300 U/3 mL/pen"},{type:"L",name:"Toujeo",keyword:"TOUJEO",generic:"Insulin Glargine",brand:"Toujeo SoloStar Solution for Injection, 450 U/1.5 mL/pen"},{type:"I",name:"NPH",keyword:"HUMULIN N",generic:"Isophane Insulin Suspension",brand:"Humulin N (NPH) 1000 U/10 mL/vial"},{type:"R",name:"NovoRapid",keyword:"NOVORAPID FLEXPEN",generic:"Insulin Aspart",brand:"NovoRapid FlexPen 300 U/3 mL/pen"},{type:"R",name:"NovoRapid",keyword:"NOVORAPID PENFILL",generic:"Insulin Aspart",brand:"兒 NovoRapid Penfill 300 U/3 mL/penfill"},{type:"R",name:"Humalog",keyword:"HUMALOG KWIKPEN INJECTION",generic:"Insulin Lispro",brand:"Humalog KwikPen Injection, 100 U/mL, 300 U/3 mL/pen"},{type:"S",name:"RI",keyword:"HUMULIN R",generic:"Regular Insulin",brand:"Humulin R 1000 U/10 m/vial"},{type:"IR",name:"Humalog 50",keyword:"HUMALOG MIX50 KWIKPEN",generic:"50% Insulin Lispro and 50% Insulin Lispro Protamine",brand:"Humalog Mix50 KwikPen, 300 U/3 mL/pen"},{type:"IR",name:"NovoMix 30",keyword:"NOVOMIX 30 FLEXPEN",generic:"Insulin Aspart 30% and Insulin Aspart Protamine Susp. 70%",brand:"NovoMix 30 FlexPen 300 U/3 mL/pen"}];function range(value,arry,prop){let i;if(prop){for(i=arry.length-1;i>0&&value<arry[i][prop];i--);return arry[i];}else{for(i=arry.length-1;i>0&&value<arry[i];i--);return i;}}let periods=[{name:"TID1",time:400},{name:"TID2",time:900},{name:"TID3",time:1400},{name:"HS",time:1900},];document.querySelectorAll("svg > text.svg-drug").forEach(function(drug){if(drug.textContent.toLowerCase().indexOf("insulin")!=-1){let insulin=drug.getAttribute("title").toUpperCase();for(let inf of insulins){if(insulin.indexOf(inf.keyword)!=-1){insulin=inf;break;}}document.querySelectorAll("svg > path.svg-given[index=\""+drug.getAttribute("index")+"\"]").forEach(function(given){given={date:range(Number(given.getAttribute("d").match(/M ([0-9\.]+) /)[1]),table,"x").date,time:given.getAttribute("title").replace(/.*(\d\d)點(\d\d)分.*/,"$1$2"),period:"",drug:insulin,dose:Number(given.getAttribute("title").match(/([0-9]+)U/)[1])};given.period=range(given.time,periods,"time").name;table[given.date].insulin[given.period].push(given);});}});document.querySelectorAll("#BloodSugar_2 li").forEach(function(li){li={date:standarizeDate(li.getAttribute("mytime")),time:li.getAttribute("mytime").replace(/.+(\d\d):(\d\d).+/,"$1$2"),period:"",value:Number(li.getAttribute("myvalue").replace("(STAT)",""))};li.period=range(li.time,periods,"time").name;table[li.date].sugar[li.period].push(li);});let t,r,b,th;t=document.createElement("table");t.classList.add("SI-panel");r=t.createTHead().insertRow();r.innerHTML="<th></th><th>前晚睡前<br>Insulin</th><th>早餐前<br>Sugar</th><th>早餐前<br>Insulin</th><th>中餐前<br>Sugar</th><th>中餐前<br>Insulin</th><th>晚餐前<br>Sugar</th><th>晚餐前<br>Insulin</th><th>睡前<br>Sugar</th>";b=t.createTBody();table.forEach(function(tr,index){r=b.insertRow();r.insertCell().innerText=tr.date;(index>0)?(insertCellFromTable(r,table[index-1].insulin.HS)):r.insertCell().innerHTML="";insertCellFromTable(r,tr.sugar.TID1);insertCellFromTable(r,tr.insulin.TID1);insertCellFromTable(r,tr.sugar.TID2);insertCellFromTable(r,tr.insulin.TID2);insertCellFromTable(r,tr.sugar.TID3);insertCellFromTable(r,tr.insulin.TID3);insertCellFromTable(r,tr.sugar.HS);});function insertCellFromTable(r,os){c=r.insertCell();os.forEach(function(o){if(o.drug){let wrap=document.createElement("div");wrap.innerText=o.dose+"U";wrap.title=o.date+" "+o.time.replace(/(\d\d)(\d\d)/,"$1:$2")+"\r\n"+o.drug.brand;c.appendChild(wrap);}else{let wrap=document.createElement("div");wrap.innerText=o.value;wrap.title=o.date+" "+o.time.replace(/(\d\d)(\d\d)/,"$1:$2");c.appendChild(wrap);}});}let panelStyle=document.createElement("style");panelStyle.innerText="table.SI-panel, table.SI-panel th, table.SI-panel td {border: 1px solid black;border-collapse: collapse;text-align: center;} table.SI-panel td, table.SI-panel th {width: 100px;}";document.getElementById("TableCode").appendChild(t);document.getElementById("TableCode").appendChild(panelStyle);}' title="在TPR頁面點擊此書籤按鈕，生成血糖-胰島素表格">血糖胰島素整理</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Nursing/CatheterCare.aspx' + location.search, 'CatheterCare' );">管</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Nursing/NursingProgressNote.aspx' + location.search, 'NursingProgressNote' );">護程</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/OffDutyNurV2.aspx' + location.search, 'OffDutyNurV2' );">護交</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Nursing/Problem_PlanNote.aspx' + location.search, 'Problem_PlanNote' );">護理問題與措施紀錄</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/OrderDisplay.aspx' + location.search, 'OrderDisplay' );">囑</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientOrderScheduling/OrderScheduling.aspx' + location.search, 'OrderScheduling' );">檢排</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/OPManagement/OrderOpSchedule.aspx' + location.search, 'OrderOpSchedule' );">術排</a>
				</td>
				<td>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/ElectronicMedicalReportViewer/MobileMasterPage.aspx'+'?'+chartno[1]), 'MobileMasterPage' );">報(未完成)</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/PACSImageShowList2.aspx' + location.search, 'PACSImageShowList2' );">PACS</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/ElectronicMedicalReportViewer/MedicalReportContent.aspx' + location.search, 'MedicalReportContent' );">報</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/SimpleInfoShowUsingPlaceHolder.aspx' + location.search.replace(/Func=[A-Za-z]+/,'') + '&Func=RISReport', 'RISReport');">影報</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/SimpleInfoShowUsingPlaceHolder.aspx' + location.search.replace(/Func=[A-Za-z]+/,'') + '&Func=SonoPERReport', 'SonoPERReport');">超報</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/ElectronicMedicalReportViewer/ExternalPage/DWHistoricalLabReport.aspx' + location.search + '&hfdPersonid='+(location.search.match(/PersonID=([a-zA-Z][0-9]{9})/)[1]||''), 'DWHistoricalLabReport' );">歷史報告</a>
				</td>
				<td>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/DoctorEnterOrder.aspx' + location.search, 'DoctorEnterOrder' );">診</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/MedicationV2.aspx' + location.search, 'MedicationV2' );">處</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/DoctorDietMain.aspx' + location.search, 'DoctorDietMain' );">食</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/NotifyOtherDoctor.aspx' + location.search, 'NotifyOtherDoctor' );">照</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/BloodStock/Pages/His/CreateOrder.aspx' + location.search, 'BloodStockCreateOrder' );">血</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/ConsentFormWeb/CreateConsentForm.aspx' + location.search, 'CreateConsentForm' );">同意書</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/Chemotherapy/MainPage.aspx' + location.search, 'ChemotherapyMainPage' );">黃單</a>
				</td>
				<td>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/InsertAdmissionNoteContent.aspx' + location.search, 'InsertAdmissionNoteContent' );">入</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/EnterTakeCarePersonInfo.aspx' + location.search, 'EnterTakeCarePersonInfo' );">績效</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/ConfirmDiagnosisOrder.aspx' + location.search, 'ConfirmDiagnosisOrder' );">身分</a>
					
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/DoctorPrePareDischargeV2.aspx' + location.search, 'DoctorPrePareDischargeV2' );">準</a>
					<a href="javascript: open('http://hisaw.ntuh.gov.tw/WebApplication/Clinics/DiagCertificate_New.aspx' + location.search, 'DiagCertificate_New' );">證</a>
					<a href="javascript: open('http://hisaw.ntuh.gov.tw/WebApplication/Clinics/ClinicRoomAdministration.aspx' + location.search+'?I'+accountidse[0], 'ClinicRoomAdministration' );">約(未完成)</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/InPatient/Ward/InsertDisChargeNoteContent.aspx' + location.search, 'InsertDisChargeNoteContent' );">出</a>
					<a href="javascript: open('http://ihisaw.ntuh.gov.tw/WebApplication/OtherIndependentProj/PatientBasicInfoEdit/SimpleInfoShowUsingPlaceHolder.aspx' + location.search.replace(/Func=[A-Za-z]+/,'') + '&Func=FutureSchedule', 'FutureSchedule');">未來</a>
					<a href="javascript: {let t='';document.querySelectorAll('.tableText, .tableText2').forEach(function(r){function td(i){return r.cells[i].textContent.trim()};t+=td(2)+'-'+td(3).slice(1)+' '+td(4)+' '+td(5)+' '+td(7).match(/[0-9]+/)[0]+td(6)+' '+td(9)+' '+td(12)+'\r\n';});console.log(t);alert('病人清單已經貼至console');}">病人清單</a>
				</td>
			</tr>
		</tbody>
	</table>
</body></html>								